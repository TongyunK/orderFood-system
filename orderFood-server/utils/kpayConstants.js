/**
 * KPay 收款机常量定义
 * 包含 API 应答码列表及相关常量
 */

/**
 * KPay API 应答码列表
 * 格式：应答码 => 描述
 */
const KPAY_RESPONSE_CODES = {
  // ========== 成功类应答码 ==========
  10000: '成功',
  90000: 'POS 签到成功',
  700002: 'KPOS 升级成功',
  700024: '八达通应用升级成功！',
  700040: '打印成功',
  710001: '获取正扫二维码成功',
  
  // ========== 业务处理类应答码 ==========
  11000: 'POS交易转发至前台应用',
  20011: '交易处理中，请等待或主动查询交易结果',
  20014: '交易查询中……',
  20016: '等待前台应用处理中，请等待或主动查询交易结果',
  20017: '正扫交易关闭，请以用户实际支付结果为准',
  700039: '开始打印...',
  700027: '请在POS输入密码(PIN)',
  700028: '已确认密码(PIN)',
  700031: '跳过密码(PIN)',
  
  // ========== 交易错误类应答码 (20001-20026) ==========
  20001: '交易号已存在',
  20002: '金额不正确',
  20003: '货币不支持',
  20004: '小费超出限额',
  20005: '未找到相关交易',
  20006: '此交易状态无法撤销/退款',
  20007: '隔日交易，无法撤销',
  20008: '终端不支持小费',
  20009: '支付类型不支持',
  20010: '交易已完成，无法关闭',
  20012: '此交易类型不支持撤销',
  20013: '此交易类型不支持小费',
  20015: '会员信息不存在',
  20018: '管理员密码错误',
  20019: '交易关闭失败，请手动关闭',
  20020: '此交易状态无法进行小费调整',
  20021: '此交易类型不支持小费调整',
  20022: '此交易已存在小费调整纪录',
  20023: '小费金额超过限制',
  20024: '订单金额已全额退回，不可再进行退款',
  20025: '卡号码不正确',
  20026: '此交易类型不支持退款',
  
  // ========== 参数错误类应答码 (10001) ==========
  10001: '参数无效',
  
  // ========== 认证授权类应答码 (40001-40011) ==========
  40001: '认证失败',
  40002: '签名无效',
  40003: '访问未授权',
  40004: '工作秘钥不存在，请重新签到',
  40005: '生成密钥对失败',
  40006: '开发者应用信息不存在',
  40007: '开发者应用认证失败',
  40008: '应用未签到，请先在KpayPos中签到',
  40010: '前台应用未签到',
  40011: '消息转发失败',
  
  // ========== 系统错误类应答码 (50001-50012) ==========
  50001: '未知错误',
  50002: '终端繁忙',
  50003: '打印机状态异常(详细错误信息参考响应数据的message)',
  50004: '请求过于频繁',
  50005: 'KPay POS未设置后台模式',
  50006: '末笔交易未完成,请在POS上进行查询',
  50007: '末笔交易失败,请在POS上进行冲正',
  50008: '末笔交易撤销失败,请在POS上重试撤销',
  50009: '终端状态异常，请先进行结算操作',
  50010: '结算失败',
  50011: '终端尚未经过结算，无法查询上一次结算的数据',
  50012: '结算数据为空',
  
  // ========== 金额调整类应答码 (60002-60004) ==========
  60002: '调整后的金额不能大于原支付金额',
  60003: '此交易仅支持修改支付金额',
  60004: '优惠金额无效',
  
  // ========== POS签到类应答码 (90001) ==========
  90001: 'POS 签到失败',
  
  // ========== KPOS升级类应答码 (700001-700003) ==========
  700001: 'KPOS 正在升级中',
  700003: '应用更新失败',
  
  // ========== Kiosk模式限制类应答码 (700004-700009, 700037-700038) ==========
  700004: 'Kiosk 模式不支持小费',
  700005: 'Kiosk 模式不支持撤销',
  700006: 'Kiosk 模式不支持退款',
  700007: 'Kiosk 模式不支持打印操作',
  700008: 'Kiosk 模式不支持正扫交易',
  700009: 'Kiosk 模式不支持八达通交易',
  700037: 'Kiosk 模式不支持小费调整',
  700038: 'Kiosk 模式不支持小费调整撤销',
  700019: 'Kiosk 模式必须选择支付类型',
  
  // ========== 系统操作类应答码 (700010-700018) ==========
  700010: '签退失败',
  700011: '设备存储空间不足',
  700012: 'KSN数据丢失，请重新登录',
  700013: '二维码串码不能为空',
  700014: '二维码无效',
  700015: '当前不支持此操作',
  700016: '读卡错误',
  700017: 'ActionCallback未设置',
  700018: 'ActionCallback无效',
  
  // ========== 交易处理类应答码 (700020-700036) ==========
  700020: '交易失败，发起冲正',
  700021: '交易冲正成功，请重新发起交易',
  700022: '交易冲正失败，请重试冲正',
  700023: '八达通应用正在升级中！',
  700025: '八达通应用升级失败',
  700029: '取消密码(PIN)',
  700030: '密码(PIN)校验失败',
  700032: '查询失败，请稍后再试(KIOSK模式下获取正扫二维码数据过早，二维码还未获取成功)',
  700033: '查询失败，请稍后再试(KIOSK模式下正扫查询交易结果过早，二维码还未获取成功)',
  700034: '交易未完成,请查询',
  700035: '交易失败,请冲正',
  700036: '八达通交易未完成,请在POS上重试或忽略',
  
  // ========== 打印类应答码 (700041) ==========
  700041: '打印失败'
};

/**
 * 根据应答码获取描述信息
 * @param {number|string} code - 应答码
 * @returns {string} 应答码描述，如果未找到则返回 '未知应答码'
 */
function getResponseMessage(code) {
  const codeNum = typeof code === 'string' ? parseInt(code, 10) : code;
  return KPAY_RESPONSE_CODES[codeNum] || `未知应答码: ${code}`;
}

/**
 * 成功应答码列表
 */
const SUCCESS_CODES = [
  10000,  // 成功
  90000,  // POS 签到成功
  700002, // KPOS 升级成功
  700024, // 八达通应用升级成功！
  700040, // 打印成功
  710001  // 获取正扫二维码成功
];

/**
 * 判断应答码是否表示成功
 * @param {number|string} code - 应答码
 * @returns {boolean} 是否为成功应答码
 */
function isSuccessCode(code) {
  const codeNum = typeof code === 'string' ? parseInt(code, 10) : code;
  return SUCCESS_CODES.includes(codeNum);
}

/**
 * 判断应答码是否表示失败
 * @param {number|string} code - 应答码
 * @returns {boolean} 是否为失败应答码
 */
function isErrorCode(code) {
  return !isSuccessCode(code);
}

module.exports = {
  KPAY_RESPONSE_CODES,
  SUCCESS_CODES,
  getResponseMessage,
  isSuccessCode,
  isErrorCode
};
